<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loop Automation - Project Management</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- PDF Export Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="2.5"/>
                        <path d="M14 20C14 16.6863 16.6863 14 20 14C23.3137 14 26 16.6863 26 20" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
                        <circle cx="20" cy="20" r="3" fill="currentColor"/>
                    </svg>
                </div>
                <div class="logo-text">
                    <span class="logo-name">Loop</span>
                    <span class="logo-sub">Automation</span>
                </div>
            </div>
            
            <nav class="nav-menu">
                <button class="nav-item active" data-view="dashboard">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7" rx="1"/>
                        <rect x="14" y="3" width="7" height="7" rx="1"/>
                        <rect x="3" y="14" width="7" height="7" rx="1"/>
                        <rect x="14" y="14" width="7" height="7" rx="1"/>
                    </svg>
                    <span>Dashboard</span>
                </button>
                <button class="nav-item" data-view="gantt">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="3" y1="12" x2="15" y2="12"/>
                        <line x1="3" y1="18" x2="18" y2="18"/>
                        <circle cx="21" cy="6" r="2" fill="currentColor"/>
                        <circle cx="15" cy="12" r="2" fill="currentColor"/>
                        <circle cx="18" cy="18" r="2" fill="currentColor"/>
                    </svg>
                    <span>Gantt Chart</span>
                </button>
                <button class="nav-item" data-view="team">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="7" r="4"/>
                        <path d="M5 21v-2a4 4 0 014-4h6a4 4 0 014 4v2"/>
                    </svg>
                    <span>Team Members</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <!-- Admin Login Button -->
                <button class="btn-admin" id="admin-login-btn" onclick="showAdminLoginModal()" style="display: flex;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2"/>
                        <path d="M7 11V7a5 5 0 0110 0v4"/>
                    </svg>
                    Admin Login
                </button>
                
                <!-- Admin Indicator & Logout -->
                <div id="admin-indicator" style="display: none; flex-direction: column; gap: 8px;">
                    <div style="display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(0, 212, 170, 0.1); border-radius: 6px; border: 1px solid rgba(0, 212, 170, 0.3);">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#00d4aa" stroke-width="2" style="width: 16px; height: 16px;">
                            <path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                        </svg>
                        <span style="color: #00d4aa; font-size: 0.85rem; font-weight: 600;">ADMIN MODE</span>
                    </div>
                    <button class="btn-logout" id="admin-logout-btn" onclick="adminLogout()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                            <polyline points="16 17 21 12 16 7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                        Logout
                    </button>
                </div>
                
                <button class="btn-validate" onclick="validateProject()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 12l2 2 4-4"/>
                        <circle cx="12" cy="12" r="9"/>
                    </svg>
                    Validate Project
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard View -->
            <section id="dashboard-view" class="view active">
                <header class="view-header">
                    <h1>Project Dashboard</h1>
                    <p class="view-subtitle">Overview of project status and team workload</p>
                </header>

                <div class="dashboard-grid">
                    <!-- Stats Cards -->
                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="stat-icon total">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                                    <path d="M3 9h18"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="total-phases">0</span>
                                <span class="stat-label">Stations</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon tasks">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/>
                                    <rect x="9" y="3" width="6" height="4" rx="1"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="total-tasks">0</span>
                                <span class="stat-label">Total Tasks</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon complete">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 12l2 2 4-4"/>
                                    <circle cx="12" cy="12" r="9"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="completed-tasks">0</span>
                                <span class="stat-label">Completed</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon progress">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="9"/>
                                    <path d="M12 6v6l4 2"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="in-progress-tasks">0</span>
                                <span class="stat-label">In Progress</span>
                            </div>
                        </div>
                    </div>

                    <!-- Hours Overview -->
                    <div class="hours-overview">
                        <h3>Hours Overview</h3>
                        <div class="hours-grid">
                            <div class="hours-item">
                                <span class="hours-value" id="total-est-hours">0</span>
                                <span class="hours-label">Estimated Hours</span>
                            </div>
                            <div class="hours-item">
                                <span class="hours-value" id="total-actual-hours">0</span>
                                <span class="hours-label">Actual Hours</span>
                            </div>
                            <div class="hours-item">
                                <span class="hours-value" id="remaining-hours">0</span>
                                <span class="hours-label">Remaining</span>
                            </div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="hours-progress"></div>
                        </div>
                    </div>

                    <!-- Team Workload -->
                    <div class="team-workload">
                        <h3>Team Workload</h3>
                        <div class="workload-table-container">
                            <table class="workload-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Role</th>
                                        <th>Target Hrs</th>
                                        <th>Assigned Hrs</th>
                                        <th>Variance</th>
                                        <th>Load</th>
                                    </tr>
                                </thead>
                                <tbody id="workload-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Gantt Chart View (Station Overview) -->
            <section id="gantt-view" class="view">
                <header class="view-header">
                    <div class="header-left">
                        <h1>Gantt Chart - Station Overview</h1>
                        <p class="view-subtitle">Click on a station row to view detailed task breakdown</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn-secondary" onclick="exportToPDF()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                            Export PDF
                        </button>
                        <button class="btn-secondary" onclick="exportToCSV()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                <polyline points="7,10 12,15 17,10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            Export CSV
                        </button>
                        <button class="btn-primary" onclick="addNewStation()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Add Station
                        </button>
                    </div>
                </header>

                <div class="gantt-container-full" id="gantt-export-area">
                    <div class="gantt-table-wrapper">
                        <!-- Station Table -->
                        <div class="station-table-scroll">
                            <table class="station-table">
                                <thead>
                                    <tr>
                                        <th style="width: 40px;">#</th>
                                        <th style="width: 250px;">Station Name</th>
                                        <th style="width: 200px;">Description</th>
                                        <th style="width: 110px;">Start Date</th>
                                        <th style="width: 110px;">End Date</th>
                                        <th style="width: 70px;">Days</th>
                                        <th style="width: 70px;">Tasks</th>
                                        <th style="width: 80px;">Est Hrs</th>
                                        <th style="width: 80px;">Progress</th>
                                        <th style="width: 100px;">Priority</th>
                                        <th style="width: 80px;">Color</th>
                                        <th style="width: 100px;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="station-tbody"></tbody>
                            </table>
                        </div>

                        <!-- Timeline -->
                        <div class="gantt-timeline-scroll">
                            <div class="gantt-timeline-header" id="gantt-timeline-header"></div>
                            <div class="gantt-timeline-body" id="gantt-timeline-body"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Station Detail View -->
            <section id="station-detail-view" class="view">
                <header class="view-header">
                    <div class="header-left">
                        <button class="btn-back" onclick="backToGantt()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                            Back to Gantt Chart
                        </button>
                        <h1 id="station-detail-title">Station Name</h1>
                        <p class="view-subtitle" id="station-detail-subtitle">Edit tasks directly in the table below</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn-secondary" onclick="exportStationToPDF()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                            Export PDF
                        </button>
                        <button class="btn-primary" onclick="addNewTaskToStation()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Add Task
                        </button>
                    </div>
                </header>

                <div class="station-detail-content" id="station-export-area">
                    <!-- Tasks Table with Inline Editing -->
                    <div class="tasks-detail-container">
                        <table class="tasks-detail-table-editable">
                            <thead>
                                <tr>
                                    <th style="width: 40px;">#</th>
                                    <th style="width: 200px;">Task Name</th>
                                    <th style="width: 150px;">Assigned To</th>
                                    <th style="width: 80px;">Role</th>
                                    <th style="width: 110px;">Start Date</th>
                                    <th style="width: 110px;">End Date</th>
                                    <th style="width: 70px;">Days</th>
                                    <th style="width: 80px;">Est Hrs</th>
                                    <th style="width: 80px;">Actual Hrs</th>
                                    <th style="width: 80px;">Remaining</th>
                                    <th style="width: 70px;">% Done</th>
                                    <th style="width: 120px;">Status</th>
                                    <th style="width: 100px;">Priority</th>
                                    <th style="width: 150px;">Notes</th>
                                    <th style="width: 80px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="station-tasks-tbody"></tbody>
                        </table>
                    </div>

                    <!-- Task Timeline -->
                    <div class="task-timeline-section">
                        <h3>Task Timeline</h3>
                        <div class="task-timeline-gantt">
                            <div class="task-timeline-header" id="task-timeline-header"></div>
                            <div class="task-timeline-body" id="task-timeline-body"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Team Members View -->
            <section id="team-view" class="view">
                <header class="view-header">
                    <div class="header-left">
                        <h1>Team Members</h1>
                        <p class="view-subtitle">Manage team and track assignments</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn-primary" onclick="addNewTeamMember()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Add Member
                        </button>
                    </div>
                </header>

                <div class="team-grid" id="team-grid"></div>
            </section>
        </main>
    </div>

    <!-- Team Member Modal -->
    <div class="modal-overlay" id="team-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="team-modal-title">Add Team Member</h2>
                <button class="modal-close" onclick="closeModal('team-modal')">&times;</button>
            </div>
            <form id="team-form" class="modal-body">
                <input type="hidden" id="member-index">
                <div class="form-row">
                    <div class="form-group">
                        <label for="member-name">Name</label>
                        <input type="text" id="member-name" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="member-role">Role</label>
                        <select id="member-role" required>
                            <option value="PM">Project Manager</option>
                            <option value="Lead">Lead</option>
                            <option value="Member">Member</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="member-target">Target Hours</label>
                        <input type="number" id="member-target" min="0" value="40" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="member-email">Email</label>
                        <input type="email" id="member-email">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="member-color">Color</label>
                        <input type="color" id="member-color" value="#3498db">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModal('team-modal')">Cancel</button>
                    <button type="submit" class="btn-primary">Save Member</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Validation Modal -->
    <div class="modal-overlay" id="validation-modal">
        <div class="modal validation-modal">
            <div class="modal-header">
                <h2>Project Validation</h2>
                <button class="modal-close" onclick="closeModal('validation-modal')">&times;</button>
            </div>
            <div class="modal-body" id="validation-results"></div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="closeModal('validation-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div class="modal-overlay" id="admin-login-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>Admin Login</h2>
                <button class="modal-close" onclick="closeModal('admin-login-modal')">&times;</button>
            </div>
            <form id="admin-login-form" class="modal-body" onsubmit="event.preventDefault(); adminLogin();">
                <div class="form-row">
                    <div class="form-group">
                        <label for="admin-email">Email</label>
                        <input type="email" id="admin-email" required placeholder="admin@loopmgnt.com">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="admin-password">Password</label>
                        <input type="password" id="admin-password" required placeholder="Enter password">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModal('admin-login-modal')">Cancel</button>
                    <button type="submit" class="btn-primary">Login</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
